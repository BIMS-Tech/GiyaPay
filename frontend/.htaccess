# Prevent infinite recursive URLs
RewriteEngine On

# Block access to admin pages from public
RewriteRule ^admin/ - [F,L]

# Block access to login and dashboard from public
RewriteRule ^(login|dashboard)\.html$ - [F,L]

# Prevent access to any URL with multiple /blog/ segments
RewriteRule ^blog/(blog/)+ - [F,L]

# Prevent access to any URL with multiple /frequently-asked-questions/ segments
RewriteRule ^frequently-asked-questions/(frequently-asked-questions/)+ - [F,L]

# Redirect /index.html to /
RewriteRule ^index\.html$ / [R=301,L]

# Redirect /blog/index.html to /blog.html
RewriteRule ^blog/index\.html$ /blog.html [R=301,L]

# Redirect /faq/index.html to /faq.html
RewriteRule ^faq/index\.html$ /faq.html [R=301,L]

# Redirect /contact/index.html to /contact.html
RewriteRule ^contact/index\.html$ /contact.html [R=301,L]

# Redirect /privacy-policy/index.html to /privacy-policy.html
RewriteRule ^privacy-policy/index\.html$ /privacy-policy.html [R=301,L]

# Block access to any URL with more than 3 levels deep (except FAQ pages)
RewriteCond %{REQUEST_URI} !^/frequently-asked-questions/
RewriteRule ^([^/]+/){3,} - [F,L]

# Security headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Cache control for static assets
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType image/png "access plus 1 month"
    ExpiresByType image/jpg "access plus 1 month"
    ExpiresByType image/jpeg "access plus 1 month"
    ExpiresByType image/gif "access plus 1 month"
    ExpiresByType image/svg+xml "access plus 1 month"
</IfModule>

# Gzip compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>
